<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Magnetostatic Solver - Code Walkthrough</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Merriweather:wght@400;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <style>
/* THE SETUP */
* { box-sizing: border-box; }

body {
  background-color: #e2e8f0;
  display: grid;
  grid-template-columns: 1fr;
  min-height: 100vh;
  padding: 0;
  margin: 0;
  place-items: center;
  overflow: hidden; /* Prevent scrolling in presentation mode */
}

/* SLIDE CONTAINER */
.slide-container {
  align-items: center;
  box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
  box-sizing: border-box;
  display: none; /* Hidden by default */
  flex-direction: column;
  font-family: "DM Sans", sans-serif;
  gap: 20px;
  height: 720px;
  justify-content: flex-start;
  overflow: hidden;
  padding: 40px;
  position: relative;
  width: 1280px;
  background-color: #f3f0df;
}

/* Show active slide with fade */
.slide-container.active {
    display: flex;
    animation: fadeIn 0.4s ease-in-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* THEMES */
.bg-blue { background-color: #005088; color: #f3f0df; }
.bg-cream { background-color: #f3f0df; color: #005088; }
.bg-blue h1, .bg-blue h2, .bg-blue h3, .bg-blue p, .bg-blue li, .bg-blue text { color: #f3f0df; }
.bg-cream h1, .bg-cream h2, .bg-cream h3 { color: #005088; }

/* TYPOGRAPHY */
h1 { font-family: "Merriweather", serif; font-size: 72px; text-align: center; margin-top: 150px; }
h2 { font-family: "Merriweather", serif; font-size: 44px; margin-bottom: 20px; width: 100%; border-bottom: 3px solid #11caa0; padding-bottom: 10px; }
h3 { font-family: "DM Sans", sans-serif; font-size: 28px; color: #11caa0; }
p, li { font-size: 20px; line-height: 1.5; }

/* CODE & MATH */
.code-block {
    font-family: 'Fira Code', monospace;
    font-size: 13px;
    background: #1e293b;
    color: #e2e8f0;
    padding: 15px;
    border-radius: 8px;
    white-space: pre; 
    width: 100%;
    margin-top: 10px;
    overflow-x: auto;
    margin-bottom: 0;
}

/* Specific style for large source code slides */
.code-block.scrollable {
    font-size: 11px;
    height: 550px;
    overflow-y: auto;
    white-space: pre;
    line-height: 1.4;
}

.math-large { font-size: 42px; font-family: "Merriweather", serif; margin: 20px 0; text-align: center; font-weight: 700; }
.math-inline { font-family: "Merriweather", serif; font-style: italic; font-weight: 600; }

/* LAYOUT HELPERS */
.grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; width: 100%; align-items: flex-start; flex-grow: 1; }
.grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; width: 100%; margin-top: 20px; }
.step-card { background: white; padding: 20px; border-radius: 12px; border: 1px solid #cbd5e1; text-align: center; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; }
.step-card h3 { font-size: 22px; margin: 10px 0; color: #005088; }
.step-card p { font-size: 16px; margin: 0; }

.img-frame { width: 100%; height: 280px; border-radius: 8px; overflow: hidden; background: #fff; border: 2px solid #005088; position: relative; display: flex; align-items: center; justify-content: center; }
.img-frame.small { height: 140px; border: none; background: transparent; }
.img-frame img { width: 100%; height: 100%; object-fit: cover; }

.keyword { color: #cba6f7; }
.def { color: #89b4fa; }
.comment { color: #6c7086; font-style: italic; }

/* Matrix Viz */
.matrix-grid { display: grid; grid-template-columns: repeat(10, 1fr); width: 200px; margin: 0 auto; gap: 2px; }
.matrix-cell { width: 18px; height: 18px; background: #e2e8f0; border-radius: 2px; }
.matrix-cell.filled { background: #11caa0; }

/* Workflow boxes */
.workflow-stage {
    background: white;
    padding: 15px;
    border-radius: 12px;
    margin-bottom: 12px;
}
.stage-init { border-left: 6px solid #005088; }
.stage-solve { border-left: 6px solid #11caa0; }
.stage-field { border-left: 6px solid #ef4444; }

/* Math container for proper formula display */
.math-container {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 15px;
    margin-top: 15px;
    font-size: 24px;
    color: #005088;
    font-family: "Merriweather", serif;
}
.math-term {
    display: flex;
    flex-direction: column;
    align-items: center;
}
.math-brace {
    width: 100%;
    height: 8px;
    border-bottom: 2px solid #11caa0;
    border-left: 2px solid #11caa0;
    border-right: 2px solid #11caa0;
    margin-bottom: 5px;
}
.math-label {
    font-size: 14px;
    color: #11caa0;
    font-family: "DM Sans", sans-serif;
    margin-top: 5px;
    text-align: center;
}

/* New Styles for Quadrature Slide */
.math-display {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    border-left: 4px solid #11caa0;
    margin: 20px 0;
    font-family: "Merriweather", serif;
    font-size: 26px;
    text-align: center;
    color: #005088;
}
.variable-list {
    list-style: none;
    padding: 0;
    margin: 20px 0;
}
.variable-list li {
    display: flex;
    align-items: baseline;
    margin-bottom: 10px;
    font-size: 18px;
}
.var-symbol {
    font-family: "Merriweather", serif;
    font-weight: bold;
    color: #11caa0;
    width: 40px;
    text-align: right;
    margin-right: 15px;
}

/* UPDATED CSS for Vertical Summation & Info Box */
.sum-wrapper {
    display: inline-grid;
    grid-template-rows: auto auto auto;
    justify-items: center;
    vertical-align: middle;
    line-height: 1;
    margin: 0 10px;
    position: relative;
    top: -12px;
}
.sum-top { 
    font-size: 12px; 
    font-weight: bold; 
    margin-bottom: 2px;
}
.sum-symbol { 
    font-size: 28px; 
    font-family: serif; 
}
.sum-bottom { 
    font-size: 12px; 
    font-weight: bold; 
    margin-top: 2px;
}
.quad-info-box {
    background: white;
    border: 2px solid #11caa0;
    border-radius: 8px;
    padding: 10px;
    margin-top: 15px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
}

/* NAVIGATION CONTROLS */
.controls-container {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 20px;
    align-items: center;
    background: rgba(255, 255, 255, 0.9);
    padding: 10px 20px;
    border-radius: 50px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    z-index: 1000;
}

.nav-btn {
    background: #005088;
    color: white;
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s, transform 0.1s;
}

.nav-btn:hover { background: #003d66; transform: scale(1.05); }
.nav-btn:active { transform: scale(0.95); }
.nav-btn:disabled { background: #cbd5e1; cursor: not-allowed; opacity: 0.7; }

.slide-counter {
    font-family: "DM Sans", sans-serif;
    font-weight: bold;
    color: #005088;
    min-width: 60px;
    text-align: center;
}

/* PRINT MEDIA QUERIES */
@media print {
    .controls-container { display: none !important; }
    body { 
        display: block !important; 
        background-color: white !important; 
        padding: 0 !important; 
        margin: 0 !important; 
        overflow: visible !important;
    }
    .slide-container { 
        display: flex !important;
        page-break-after: always; 
        break-after: page; 
        box-shadow: none !important; 
        margin: 0 !important; 
        width: 100% !important; 
        height: 720px !important;
        border: none !important;
        opacity: 1 !important;
        transform: none !important;
    }
    .bg-blue { background-color: #005088 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    .bg-cream { background-color: #f3f0df !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
}
    </style>
</head>
<body>

<div class="controls-container">
    <button class="nav-btn" id="prevBtn" onclick="changeSlide(-1)"><i class="fas fa-chevron-left"></i></button>
    <div class="slide-counter" id="counter">1 / 14</div>
    <button class="nav-btn" id="nextBtn" onclick="changeSlide(1)"><i class="fas fa-chevron-right"></i></button>
</div>

<div class="slide-container bg-blue active">
    <h1>Magnetostatic Solver</h1>
    <p style="font-size: 32px; opacity: 0.8;">Solving ∇²A = −μ₀J using Finite Elements Method (FEM)</p>
    <p style="font-size: 20px; margin-top: 40px; opacity: 0.7;">Forward Problem: J → B for ML Training Data Generation</p>
</div>

<div class="slide-container bg-cream">
    <h2>The FEM Process: Code Roadmap</h2>
    
    <p style="margin-bottom: 30px;">
        Transforming the physical problem into a solvable linear system.
    </p>

    <div class="grid-4" style="margin-top: 0;">
        
        <div class="step-card">
            <h3 style="font-size: 20px; margin: 8px 0; color: #005088;">1. Discretize</h3>
            <div class="img-frame small" style="height: 120px;">
                <svg viewBox="0 0 100 100" width="100" height="100">
                    <rect x="10" y="10" width="80" height="80" fill="none" stroke="#005088" stroke-width="2"/>
                    <line x1="10" y1="10" x2="90" y2="90" stroke="#005088" stroke-width="2"/>
                    <line x1="90" y1="10" x2="10" y2="90" stroke="#005088" stroke-width="2"/>
                    
                </svg>
            </div>
            <p style="font-size: 12px; margin-top: 10px; line-height: 1.4;">
                <b>Domain &rarr; Mesh</b>
                <br>
                <span style="font-size: 13px; color: #666;">
                    Define shape functions
                </span>
            </p>
        </div>
        
        <div class="step-card">
            <h3 style="font-size: 20px; margin: 8px 0; color: #005088;">2. Map Input</h3>
            <div class="img-frame small" style="height: 120px;">
                <svg viewBox="0 0 100 100" width="100" height="100">
                    <rect x="15" y="15" width="70" height="70" rx="4" fill="none" stroke="#cbd5e1" stroke-width="2" stroke-dasharray="4"/>
                    <circle cx="30" cy="30" r="3" fill="#ef4444"/>
                    <circle cx="70" cy="70" r="3" fill="#ef4444"/>
                    <path d="M50,50 L80,20" stroke="#11caa0" stroke-width="2" marker-end="url(#arrow)"/>
                    <text x="50" y="90" text-anchor="middle" font-size="12" fill="#005088" font-family="sans-serif">Input Data</text>
                </svg>
            </div>
            <p style="font-size: 15px; margin-top: 10px; line-height: 1.4;">
                <b>Pixels &rarr; Mesh Points</b>
                <br>
                <span style="font-size: 13px; color: #666;">
                    Interpolate input array
                </span>
            </p>
        </div>
        
        <div class="step-card">
            <h3 style="font-size: 20px; margin: 8px 0; color: #005088;">3. Assemble</h3>
            <div class="img-frame small" style="height: 120px;">
                <svg viewBox="0 0 100 100" width="100" height="100">
                     <rect x="25" y="25" width="50" height="50" fill="none" stroke="#005088" stroke-width="2"/>
                     <rect x="30" y="30" width="10" height="10" fill="#11caa0"/>
                     <rect x="45" y="45" width="10" height="10" fill="#11caa0"/>
                     
                </svg>
            </div>
            <p style="font-size: 15px; margin-top: 10px; line-height: 1.4;">
                <b>Build Linear System</b>
                <br>
                <span style="font-size: 13px; color: #666;">
                    Stiffness Matrix & Load Vector (KA = f)
                </span>
            </p>
        </div>
        
        <div class="step-card">
            <h3 style="font-size: 20px; margin: 8px 0; color: #005088;">4. Solve & Curl</h3>
            <div class="img-frame small" style="height: 120px;">
                <svg viewBox="0 0 100 100" width="100" height="100">
                    <line x1="10" y1="90" x2="90" y2="90" stroke="#005088" stroke-width="2"/>
                    <line x1="10" y1="90" x2="10" y2="10" stroke="#005088" stroke-width="2"/>
                    <path d="M10,90 Q50,10 90,50" fill="none" stroke="#ef4444" stroke-width="3"/>
                    <text x="60" y="35" font-size="12" fill="#ef4444" font-family="sans-serif" font-weight="bold">Output</text>
                </svg>
            </div>
            <p style="font-size: 15px; margin-top: 10px; line-height: 1.4;">
                <b>Compute Field</b>
                <br>
                <span style="font-size: 13px; color: #666;">
                    Solve Potential &rarr; Derive B
                </span>
            </p>
        </div>
    </div>
</div>

<div class="slide-container bg-blue">
    <h2>Stage 1: Initialization (__init__)</h2>
    <div class="grid-2">
        <div>
            <h3>Mesh Construction</h3>
            <p style="font-size: 16px; margin-bottom: 5px;">Constructs a rectangular tensor mesh scaled to physical dimensions.</p>
            
            <ul style="font-size: 12px; color: #a5f3fc; margin-top: 0; margin-bottom: 8px; padding-left: 18px; line-height: 1.3;">
                <li><b>nx, ny</b> : Number of mesh elements in x and y directions</li>
                <li><b>Lx, Ly</b> : Physical domain size</li>
            </ul>

            <pre class="code-block" style="margin-top: 5px; font-size: 11px;">
<span class="comment"># Create mesh - rectangular mesh scaled</span>
self.mesh = MeshTri.init_tensor(
    np.linspace(0, Lx, nx + 1),
    np.linspace(0, Ly, ny + 1)
)</pre>
            <h3 style="margin-top: 15px;">Element Type</h3>
            <p style="font-size: 16px;">Selects <b>P1 (Linear)</b> or <b>P2 (Quadratic)</b> elements based on degree.</p>
            <pre class="code-block" style="margin-top: 5px; font-size: 11px;">
<span class="comment"># Define element type based on degree</span>
self.element = ElementTriP2() <span class="keyword">if</span> degree == 2 <span class="keyword">else</span> ElementTriP1()

<span class="comment"># Create basis</span>
self.basis = Basis(self.mesh, self.element)</pre>
        </div>
        
        <div style="display: flex; flex-direction: column; gap: 10px; justify-content: center; height: 100%;">
            <div class="img-frame" style="border-color: #11caa0; background: #fff; height: 140px; min-height: 140px;">
                <svg viewBox="0 0 200 120" width="100%" height="100%" preserveAspectRatio="xMidYMid slice">
                    <defs>
                        <pattern id="triGrid" width="40" height="40" patternUnits="userSpaceOnUse">
                            <path d="M0,0 L40,0 L40,40 L0,40 Z" fill="none" stroke="#e2e8f0" stroke-width="0.5"/>
                            <path d="M0,0 L40,40" stroke="#005088" stroke-width="1"/>
                            <path d="M0,0 L40,0 L40,40 L0,40 Z" fill="none" stroke="#005088" stroke-width="1"/>
                        </pattern>
                    </defs>
                    <rect width="100%" height="100%" fill="url(#triGrid)" />
                </svg>
            </div>
            
            <div class="img-frame" style="border-color: #11caa0; background: #fff; height: 160px; min-height: 160px;">
                <img src="p1_p2_elements.png" alt="P1 vs P2 Elements" style="width: 100%; height: 100%; object-fit: contain; padding: 5px;" />
            </div>

            <p style="font-size: 13px; color: #a5f3fc; line-height: 1.4; background: rgba(0,0,0,0.1); padding: 8px; border-radius: 6px;">
                The <b>degree of freedom (DOF)</b> for P1 and P2 elements refers to how many independent values you need to store per element to fully determine the basis function. This directly determines the size of your linear system.
            </p>
        </div>
    </div>
</div>

<div class="slide-container bg-cream">
    <h2>What Are Quadrature Points?</h2>
    <div class="grid-2">
        <div style="padding-right: 20px;">
            <p style="font-size: 18px; margin-bottom: 15px;">Quadrature points (or integration points) act as a bridge between <b>continuous mathematics</b> (integration) and <b>discrete computation</b> (matrix assembly).</p>
            <p style="font-size: 18px; margin-bottom: 20px;">By choosing points and weights carefully, we can approximate integrals <b>exactly for polynomials</b>, making FEM both mathematically rigorous and computationally efficient.</p>
            
            <div class="math-display">
                ∫<sub>Ω</sub> f(x) dx ≈ 
                <div class="sum-wrapper">
                    <span class="sum-top">n</span>
                    <span class="sum-symbol">∑</span>
                    <span class="sum-bottom">i=1</span>
                </div>
                w<sub>i</sub> · f(x<sub>i</sub>)
            </div>
            
            <ul class="variable-list" style="margin-top: 20px;">
                <li><span class="var-symbol">x<sub>i</sub></span> Coordinates of quadrature points</li>
                <li><span class="var-symbol">w<sub>i</sub></span> Quadrature weights</li>
                <li><span class="var-symbol">n</span> Number of quadrature points</li>
            </ul>
        </div>
        
        <div style="display: flex; flex-direction: column; justify-content: center; height: 100%;">
            <div class="img-frame" style="height: 400px; border-color: #005088;">
                <img src="quadrature_points.png" alt="Quadrature Points Illustration" style="padding: 20px; object-fit: contain;" />
            </div>
            <p style="text-align: center; margin-top: 15px; color: #005088; font-style: italic; font-size: 16px;">Sampling locations within a reference element</p>
        </div>
    </div>
</div>

<div class="slide-container bg-cream" style="padding-top: 20px; padding-bottom: 20px;">
    <h2>Stage 1.5: Boundary Conditions & Weak Form</h2>
    <div class="grid-2">
        <div style="padding-right: 10px;">
            <h3>Boundary Identification</h3>
            <p style="font-size: 16px;">Identifies boundary DOFs where Dirichlet BCs (<span class="math-inline">A = 0</span>) are applied using a small epsilon.</p>
            <pre class="code-block" style="margin-top: 8px; font-size: 11px;">
<span class="comment"># Find boundary DOFs for Dirichlet BC</span>
epsilon = 1e-10
self.boundary_dofs = self.basis.get_dofs(
    <span class="keyword">lambda</span> x: (x[0] < epsilon) | (x[0] > Lx - epsilon) | 
              (x[1] < epsilon) | (x[1] > Ly - epsilon)
).all()</pre>
            
            <div style="margin-top: 15px; width: 100%; height: 180px; background: white; border: 2px solid #005088; position: relative; border-radius: 6px;">
                 <div style="position: absolute; top: 0; left: 0; right: 0; height: 6px; background: #ef4444;"></div>
                <div style="position: absolute; bottom: 0; left: 0; right: 0; height: 6px; background: #ef4444;"></div>
                <div style="position: absolute; top: 0; bottom: 0; left: 0; width: 6px; background: #ef4444;"></div>
                <div style="position: absolute; top: 0; bottom: 0; right: 0; width: 6px; background: #ef4444;"></div>
                
                <svg style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;">
                    <line x1="0" y1="100%" x2="100%" y2="0" stroke="#ef4444" stroke-width="2" />
                </svg>

                <div style="position: absolute; inset: 6px; background-image: radial-gradient(#cbd5e1 1px, transparent 1px); background-size: 20px 20px; opacity: 0.5;"></div>
                
                <div style="position: absolute; bottom: 5px; right: 10px; font-family: 'Fira Code', monospace; font-size: 12px; color: #333;">x[0]</div>
                <div style="position: absolute; top: 10px; left: 8px; font-family: 'Fira Code', monospace; font-size: 12px; color: #333;">x[1]</div>
                
                <div style="position: absolute; top: 5px; left: 15px; height: 95%; border-left: 1px dashed #ef4444;"></div>
                
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #005088; font-weight: bold; font-size: 20px; font-family: 'Merriweather', serif;">Domain Ω</div>
                <div style="position: absolute; top: 12px; left: 50%; transform: translateX(-50%); background: white; padding: 2px 8px; border-radius: 4px; color: #ef4444; font-weight: bold; border: 1px solid #ef4444; font-size: 11px;">A = 0</div>
                <div style="position: absolute; bottom: 12px; left: 50%; transform: translateX(-50%); background: white; padding: 2px 8px; border-radius: 4px; color: #ef4444; font-weight: bold; border: 1px solid #ef4444; font-size: 11px;">A = 0</div>
            </div>
        </div>
        <div style="padding-left: 10px;">
            <h3>Mathematical Derivation</h3>
            <p style="font-size: 18px; line-height: 1.4; margin-bottom: 10px;">We integrate the <b>Strong Form</b> against a test function <i>v</i> and use Green's Identity:</p>
            
            <ol style="font-size: 18px; line-height: 1.8; margin: 10px 0 10px 20px;">
                <li><b>Strong:</b> −∇²A = μ₀J</li>
                <li><b>Integrate:</b> ∫(−∇²A)v = μ₀J</li>
                <li><b>By Parts:</b> ∫∇A·∇v − ∮(∇A·n)v = μ₀J</li>
            </ol>
            
            <p style="font-size: 16px; margin-top: 5px; font-style: italic; color: #555;">v : test function</p>
            <p style="font-size: 16px; margin-top: 5px; line-height: 1.4;">Since we apply Dirichlet BCs (A=0), test functions also satisfy <b>v=0 on the boundary</b>.</p>
            
            <div class="math-container" style="font-size: 22px; gap: 15px; margin-top: 15px;">
                <div class="math-term">
                    <span>∫∇A·∇v</span>
                    <div class="math-brace" style="border-top: none; border-bottom: 2px solid #11caa0; margin-top: 2px;"></div>
                    <span class="math-label" style="font-size: 14px;">Stiffness Matrix (K)</span>
                </div>
                <span>=</span>
                <div class="math-term">
                    <span>μ₀J</span>
                    <div class="math-brace" style="border-top: none; border-bottom: 2px solid #ef4444; border-color: #ef4444; margin-top: 2px;"></div>
                    <span class="math-label" style="color: #ef4444; font-size: 14px;">Load Vector (f)</span>
                </div>
            </div>
            
            <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 8px; margin-top: 15px; border-radius: 6px;">
                <p style="font-size: 14px; margin: 0; line-height: 1.4; color: #856404;"><b>⚠️ Note:</b> Homogeneous Dirichlet BCs used for simplicity. For open-boundary chip problems, this is an approximation.</p>
            </div>
        </div>
    </div>
</div>

<div class="slide-container bg-cream">
    <h2 style="margin-bottom: 10px; font-size: 38px;">From Weak Form to Linear System</h2>
    <div style="display: flex; flex-direction: column; gap: 10px; width: 100%; margin-top: 5px;">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div style="background: white; padding: 10px; border-radius: 8px; border-left: 4px solid #005088;">
                <h3 style="font-size: 18px; margin: 0 0 4px 0; color: #005088;">Step 1: Weak Form</h3>
                <p style="font-size: 13px; margin: 0 0 4px 0;">From strong form ∇²A = −μ₀J, multiply by test function <i>v</i> and integrate by parts:</p>
                <div style="text-align: center; font-family: 'Merriweather', serif; font-size: 18px; color: #005088; margin: 4px 0;">
                    ∫<sub>Ω</sub> ∇A·∇v dx = ∫<sub>Ω</sub> μ₀J·v dx
                </div>
                <p style="font-size: 12px; margin: 2px 0 0 0; font-style: italic; color: #666;">with A = 0 on ∂Ω</p>
            </div>
            
            <div style="background: white; padding: 10px; border-radius: 8px; border-left: 4px solid #005088;">
                <h3 style="font-size: 18px; margin: 0 0 4px 0; color: #005088;">Step 2: Discretization</h3>
                <p style="font-size: 13px; margin: 0 0 4px 0;">Approximate solution as linear combination of basis functions:</p>
                <div style="text-align: center; font-family: 'Merriweather', serif; font-size: 18px; color: #005088; margin: 4px 0;">
                    A(x,y) ≈ <span style="display: inline-grid; grid-template-rows: auto auto auto; justify-items: center; vertical-align: middle; line-height: 1; margin: 0 3px; position: relative; top: -6px;">
                        <span style="font-size: 9px; font-weight: bold; margin-bottom: 1px;">DOF</span>
                        <span style="font-size: 18px; font-family: serif;">∑</span>
                        <span style="font-size: 9px; font-weight: bold; margin-top: 1px;">i=1</span>
                    </span> A<sub>i</sub>φ<sub>i</sub>(x,y)
                </div>
                <p style="font-size: 12px; margin: 2px 0 0 0; color: #666;"><b>A<sub>i</sub></b>: coefficients, <b>φ<sub>i</sub></b>: basis functions</p>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div style="background: white; padding: 10px; border-radius: 8px; border-left: 4px solid #11caa0;">
                <h3 style="font-size: 18px; margin: 0 0 4px 0; color: #005088;">Step 3: Substitute</h3>
                <p style="font-size: 13px; margin: 0 0 4px 0;">Replace A with A<sub>I</sub> and v with φ<sub>j</sub>:</p>
                <div style="text-align: center; font-family: 'Merriweather', serif; font-size: 16px; color: #005088; margin: 4px 0; line-height: 1.4;">
                    <span style="display: inline-grid; grid-template-rows: auto auto auto; justify-items: center; vertical-align: middle; line-height: 1; margin: 0 2px; position: relative; top: -6px;">
                        <span style="font-size: 9px; font-weight: bold; margin-bottom: 1px;">DOF</span>
                        <span style="font-size: 18px; font-family: serif;">∑</span>
                        <span style="font-size: 9px; font-weight: bold; margin-top: 1px;">i=1</span>
                    </span> A<sub>i</sub> ∫ ∇φ<sub>i</sub>·∇φ<sub>j</sub> dx = ∫ μ₀J·φ<sub>j</sub> dx
                </div>
                <p style="font-size: 12px; margin: 2px 0 0 0; font-style: italic; color: #666;">for all j = 1, ..., DOF</p>
            </div>
            
            <div style="background: white; padding: 10px; border-radius: 8px; border-left: 4px solid #11caa0;">
                <h3 style="font-size: 18px; margin: 0 0 4px 0; color: #005088;">Step 4: Assemble K·A = f</h3>
                <p style="font-size: 13px; margin: 0 0 6px 0;">Form the linear system:</p>
                <div style="background: #f8f9fa; padding: 6px; border-radius: 4px; margin-bottom: 4px;">
                    <div style="font-family: 'Merriweather', serif; font-size: 14px; color: #005088; margin-bottom: 2px;">
                        <span style="color: #11caa0; font-weight: bold;">K<sub>ij</sub></span> = ∫<sub>Ω</sub> ∇φ<sub>i</sub>·∇φ<sub>j</sub> dx
                    </div>
                    <div style="font-size: 11px; color: #666; margin-left: 10px;">Stiffness Matrix</div>
                </div>
                <div style="background: #f8f9fa; padding: 6px; border-radius: 4px;">
                    <div style="font-family: 'Merriweather', serif; font-size: 14px; color: #005088; margin-bottom: 2px;">
                        <span style="color: #ef4444; font-weight: bold;">f<sub>j</sub></span> = ∫<sub>Ω</sub> μ₀J·φ<sub>j</sub> dx
                    </div>
                    <div style="font-size: 11px; color: #666; margin-left: 10px;">Load Vector</div>
                </div>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div style="background: white; padding: 10px; border-radius: 8px; border-left: 4px solid #ef4444;">
                <h3 style="font-size: 18px; margin: 0 0 4px 0; color: #005088;">Step 5-6: Apply BCs & Solve</h3>
                <p style="font-size: 13px; margin: 0 0 4px 0;">Modify system to enforce A = 0 at boundary DOFs, then solve:</p>
                <div style="text-align: center; font-family: 'Merriweather', serif; font-size: 20px; color: #005088; margin: 8px 0;">
                    K<sub>bc</sub>·<b style="color: #ef4444;">A</b> = f<sub>bc</sub>
                </div>
                <p style="font-size: 12px; margin: 4px 0 0 0; color: #666;">Yields coefficients <b>A<sub>i</sub></b> for solution field.</p>
            </div>
            <div style="background: white; padding: 10px; border-radius: 8px; border-left: 4px solid #ef4444;">
                <h3 style="font-size: 18px; margin: 0 0 4px 0; color: #005088;">Step 7-8: Reconstruct & B</h3>
                <p style="font-size: 13px; margin: 0 0 4px 0;"><b>7:</b> Interpolate A from DOF values to regular grid (P1/P2).</p>
                <p style="font-size: 13px; margin: 0 0 4px 0;"><b>8:</b> Compute magnetic field via curl:</p>
                <div style="text-align: center; font-family: 'Merriweather', serif; font-size: 18px; color: #005088; margin: 4px 0;">
                    B = ∇×A = (∂A/∂y, −∂A/∂x)
                </div>
                <p style="font-size: 12px; margin: 2px 0 0 0; font-style: italic; color: #666;">using Central Difference Approximation</p>
            </div>
        </div>
    </div>
</div>

<div class="slide-container bg-blue">
    <h2>Stage 2: Solving (solve_from_array) - Part 1</h2>
    <div class="grid-2">
        <div style="display: flex; flex-direction: column; height: 100%; justify-content: space-between;">
            <div>
                <h3>Regular Grid Interpolation</h3>
                <p style="font-size: 16px; line-height: 1.4; margin-bottom: 5px;">
                    Since J is provided as a discrete array on a regular grid, <code>RegularGridInterpolator</code> converts it into a callable function.
                </p>
                <pre class="code-block" style="margin-top: 5px; font-size: 11px;">
<span class="keyword">from</span> scipy.interpolate <span class="keyword">import</span> RegularGridInterpolator

<span class="comment"># Create interpolator from the array</span>
x_grid = np.linspace(0, self.Lx, self.nx)
y_grid = np.linspace(0, self.Ly, self.ny)

<span class="comment"># RegularGridInterpolator expects (y, x) ordering</span>
interp = RegularGridInterpolator(
    (y_grid, x_grid), J_array, 
    bounds_error=<span class="keyword">False</span>, fill_value=0.0
)</pre>
            </div>
            
            <div class="img-frame" style="border-color: #11caa0; background: #fff; height: 150px; min-height: 150px; margin-top: 10px;">
                <img src="fem_assembly_2.jpg" alt="Assembly Detail 2" style="width: 100%; height: 100%; object-fit: contain; padding: 5px;" />
            </div>
        </div>
        
        <div style="display: flex; flex-direction: column; gap: 10px;">
            <div class="img-frame" style="border-color: #11caa0; background: #fff; height: 150px; min-height: 150px;">
                <img src="fem_assembly_1.jpg" alt="Assembly Detail 1" style="width: 100%; height: 100%; object-fit: contain; padding: 5px;" />
            </div>

            <div>
                <h3 style="color: #11caa0; margin-top: 5px;">Load Vector (f)</h3>
                <p style="font-size: 16px; line-height: 1.4; margin-bottom: 5px;">
                    Evaluates <span class="math-inline">μ₀J</span> at quadrature points via interpolation.
                </p>
                <pre class="code-block" style="margin-top: 5px; font-size: 11px;">
<span class="keyword">@LinearForm</span>
<span class="keyword">def</span> <span class="def">source_functional</span>(v, w):
    points = np.column_stack([w.x[1].flatten(), 
                              w.x[0].flatten()])
    J_vals = interp(points).reshape(w.x[0].shape)
    <span class="keyword">return</span> MU_0 * J_vals * v

f = source_functional.assemble(self.basis)</pre>
            </div>
        </div>
    </div>
</div>

<div class="slide-container bg-cream">
    <h2>Stage 2: Solving - Part 2 (Assembly)</h2>
    <div class="grid-2">
        <div>
            <h3>Stiffness Matrix (K)</h3>
            <p style="font-size: 16px;">Represents <span class="math-inline">∫ ∇u · ∇v dx</span> using scikit-fem helpers.</p>
            <p style="font-size: 15px; margin-top: 8px; line-height: 1.4;">This assembles the Laplacian operator over the mesh using a <b>Bilinear Form</b> (depends on trial <i>u</i> and test <i>v</i>).</p>
            <pre class="code-block" style="margin-top: 10px; font-size: 11px;">
<span class="keyword">@BilinearForm</span>
<span class="keyword">def</span> <span class="def">stiffness</span>(u, v, w):
    <span class="keyword">return</span> dot(grad(u), grad(v))

K = stiffness.assemble(self.basis)</pre>
            
            <div style="background: white; border: 2px solid #005088; border-radius: 8px; padding: 12px; margin-top: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.05);">
                <p style="font-weight: bold; margin-top: 0; margin-bottom: 6px; font-size: 14px; color: #005088;">Inside .assemble():</p>
                <ol style="font-size: 13px; margin: 0; padding-left: 20px; line-height: 1.4; text-align: left; color: #333;">
                    <li>Maps reference element quadrature points to physical locations</li>
                    <li>Evaluates integrand at all points</li>
                    <li>Weights and sums to approximate integral</li>
                    <li>Accumulates into global sparse matrix</li>
                </ol>
            </div>
        </div>

        <div style="display: flex; flex-direction: column; height: 100%;">
            <h3 style="margin-bottom: 10px; color: #005088; font-size: 20px;">Linear vs. Bilinear Forms</h3>
            <div class="img-frame" style="border-color: #005088; background: #fff; height: 320px; flex-grow: 1;">
                <img src="bilinear_linear_form.jpg" alt="Linear vs Bilinear Form Illustration" style="width: 100%; height: 100%; object-fit: contain; padding: 10px;" />
            </div>
            <p style="font-size: 13px; color: #666; margin-top: 8px; text-align: center; font-style: italic;">
                The Linear Form creates the Load Vector (f), while the Bilinear Form creates the Stiffness Matrix (K).
            </p>
        </div>
    </div>
</div>

<div class="slide-container bg-blue">
    <h2>Stage 2 & 3: Linear System & Field Recovery</h2>
    <div class="grid-2" style="align-items: flex-start; gap: 20px; height: 100%;">
        
        <div style="display: flex; flex-direction: column; height: 100%;">
            <h3 style="color: #11caa0; border-bottom: 2px solid rgba(255,255,255,0.2); padding-bottom: 5px; margin-bottom: 10px; font-size: 22px;">A. Linear System (A = 0)</h3>
            
            <p style="font-size: 15px; margin-bottom: 5px; margin-top: 0;">
                Enforce Dirichlet BCs and solve:
            </p>
            
            <div class="math-display" style="font-size: 20px; padding: 10px; margin: 5px 0 10px 0; background: rgba(255,255,255,0.1); border-left: 4px solid #11caa0; color: white;">
                K<sub>bc</sub> ⋅ A = f<sub>bc</sub>
            </div>
            
            <pre class="code-block" style="margin-top: 5px; font-size: 11px; padding: 10px;">
<span class="comment"># Apply Dirichlet BCs (A = 0 on boundary)</span>
K_bc, f_bc = enforce(K, f, D=self.boundary_dofs)

<span class="comment"># Solve the linear system</span>
A_solution = spsolve(K_bc, f_bc)</pre>
            
            <div style="margin-top: 10px; font-size: 13px; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px; flex-grow: 1;">
                <p style="margin: 0 0 6px 0; line-height: 1.4;"><strong style="color: #11caa0;">enforce()</strong>: (scikit-fem) Zeros out rows/cols for boundary DOFs, ensuring <span class="math-inline">A = 0</span>.</p>
                <p style="margin: 0; line-height: 1.4;"><strong style="color: #11caa0;">spsolve()</strong>: (scipy.sparse) Solves sparse systems using optimized LU decomposition.</p>
            </div>
        </div>

        <div style="display: flex; flex-direction: column; height: 100%; padding-left: 15px; border-left: 2px dashed rgba(255,255,255,0.2);">
            <h3 style="color: #ef4444; border-bottom: 2px solid rgba(255,255,255,0.2); padding-bottom: 5px; margin-bottom: 5px; font-size: 22px;">B. Field Recovery</h3>
            
            <div style="background: rgba(255,255,255,0.1); border-left: 4px solid #ef4444; padding: 8px 15px; margin-bottom: 10px; color: white; display: flex; align-items: center; justify-content: center; gap: 10px;">
                <span style="font-family: 'Merriweather', serif; font-size: 18px;">B = ∇×A = (∂A/∂y, −∂A/∂x)</span>
            </div>
            
            <div class="img-frame" style="border: 2px solid #ef4444; background: #fff; height: 180px; min-height: 180px; margin-bottom: 10px;">
                <img src="magnetic_field_calculation.jpg" alt="Magnetic Field Calculation Stencil" style="width: 100%; height: 100%; object-fit: contain; padding: 5px;" />
            </div>

            <p style="font-size: 12px; margin: 0 0 5px 0; color: #a5f3fc; text-align: center; font-style: italic;">
                Central Difference Approximation applied to the grid
            </p>

            <pre class="code-block" style="margin-top: 0; font-size: 10px; line-height: 1.3; overflow-y: auto; flex-grow: 1; padding: 10px; height: 0px;">
<span class="comment"># B_x = dA/dy (central differences)</span>
Bx = np.zeros_like(A_grid)
Bx[1:-1, :] = (A_grid[2:, :] - A_grid[:-2, :]) / (2 * dy)
Bx[0, :] = (A_grid[1, :] - A_grid[0, :]) / dy    <span class="comment"># Forward</span>
Bx[-1, :] = (A_grid[-1, :] - A_grid[-2, :]) / dy <span class="comment"># Backward</span>

<span class="comment"># B_y = -dA/dx</span>
By = np.zeros_like(A_grid)
By[:, 1:-1] = -(A_grid[:, 2:] - A_grid[:, :-2]) / (2 * dx)
By[:, 0] = -(A_grid[:, 1] - A_grid[:, 0]) / dx
By[:, -1] = -(A_grid[:, -1] - A_grid[:, -2]) / dx</pre>
        </div>
    </div>
</div>
<div class="slide-container bg-cream">
    <h2>Grid Interpolation</h2>
    <div class="grid-2" style="height: 100%; align-items: stretch;">
        
        <div style="display: flex; flex-direction: column; justify-content: flex-start; height: 100%;">
            <h3>Solution to Regular Grid</h3>
            <p style="font-size: 16px; margin-bottom: 10px;">
                Converts irregular FEM results (triangles) to a regular grid (pixels) using <code>LinearNDInterpolator</code> (P1) or basis interpolation (P2).
            </p>
            <pre class="code-block" style="margin-top: 5px; font-size: 11px; margin-bottom: 15px;">
<span class="keyword">def</span> <span class="def">_solution_to_grid</span>(self, solution):
    <span class="comment"># For P1 elements, linear interp from mesh nodes</span>
    interp = LinearNDInterpolator(
        coords, solution, fill_value=0.0
    )
    <span class="keyword">return</span> interp(X, Y)</pre>
            
            <div style="background: white; border: 1px solid #cbd5e1; border-radius: 8px; padding: 10px; margin-top: auto; box-shadow: 0 4px 6px rgba(0,0,0,0.05);">
                <h3 style="margin: 0 0 8px 0; font-size: 15px; color: #005088; border-bottom: 2px solid #11caa0; display: inline-block;">Advantages of Regular Grid</h3>
                <ul style="margin: 0; padding-left: 0; list-style: none;">
                    <li style="margin-bottom: 8px; font-size: 11px; line-height: 1.3;">
                        <b style="color: #000; font-size: 11px; display: block; margin-bottom: 2px;">1. Enables Finite Difference Calculations</b>
                        Finite differences require uniform grid spacing
                    </li>
                    <li style="margin-bottom: 8px; font-size: 11px; line-height: 1.3;">
                        <b style="color: #000; font-size: 11px; display: block; margin-bottom: 2px;">2. Simplifies Visualization and Data Analysis</b>
                        Visualization tools (matplotlib, plotting libraries) work naturally with regular grids
                    </li>
                    <li style="margin-bottom: 8px; font-size: 11px; line-height: 1.3;">
                        <b style="color: #000; font-size: 11px; display: block; margin-bottom: 2px;">3. Compatibility with Machine Learning Pipelines</b>
                        The solver generates training data for ML models
                    </li>
                    <li style="margin-bottom: 0; font-size: 11px; line-height: 1.3;">
                        <b style="color: #000; font-size: 11px; display: block; margin-bottom: 2px;">4. Direct Comparison with Input Data</b>
                        the source term J is provided on a regular grid
                    </li>
                </ul>
            </div>
        </div>

        <div style="display: flex; flex-direction: column; height: 100%; justify-content: center;">
            <div class="img-frame" style="border-color: #11caa0; background: #fff; height: 100%; max-height: 520px; width: 100%;">
                <img src="solution_to_grid.jpg" alt="Solution to Grid Interpolation" style="width: 100%; height: 100%; object-fit: contain; padding: 10px;" />
            </div>
        </div>
    </div>
</div>

<div class="slide-container bg-cream">
    <h2>Complete Solver Workflow</h2>
    <p style="margin-bottom: 20px;">Data pipeline from Input Array to Magnetic Field Output.</p>
    
    <div style="display: flex; align-items: center; gap: 10px; height: 100%; width: 100%;">
        
        <div style="display: flex; flex-direction: column; align-items: center; width: 100px;">
            <div style="background: #334155; color: white; padding: 10px; border-radius: 8px; text-align: center; font-size: 14px; width: 100%;">
                <b>Input</b><br>J Array
            </div>
            <div style="height: 40px; border-left: 2px dashed #334155;"></div>
            <i class="fas fa-arrow-down" style="color: #334155;"></i>
        </div>

        <div style="flex: 1; background: white; border: 1px solid #005088; border-top: 6px solid #005088; border-radius: 8px; padding: 15px; height: 320px; display: flex; flex-direction: column;">
            <h3 style="margin: 0 0 10px 0; font-size: 18px; color: #005088;">1. Initialization</h3>
            <div style="background: #f1f5f9; padding: 8px; border-radius: 4px; font-family: 'Fira Code', monospace; font-size: 11px; margin-bottom: 5px;">__init__</div>
            <ul style="font-size: 13px; line-height: 1.6; padding-left: 15px; margin: 0; color: #333;">
                <li>Build <code>MeshTri</code></li>
                <li>Define Basis (P1/P2)</li>
                <li>Identify BC DOFs</li>
            </ul>
        </div>

        <i class="fas fa-arrow-right" style="color: #cbd5e1; font-size: 20px;"></i>

        <div style="flex: 1; background: white; border: 1px solid #11caa0; border-top: 6px solid #11caa0; border-radius: 8px; padding: 15px; height: 320px; display: flex; flex-direction: column;">
            <h3 style="margin: 0 0 10px 0; font-size: 18px; color: #11caa0;">2. Solving</h3>
            <div style="background: #f1f5f9; padding: 8px; border-radius: 4px; font-family: 'Fira Code', monospace; font-size: 11px; margin-bottom: 5px;">solve_from_array</div>
            <ul style="font-size: 13px; line-height: 1.6; padding-left: 15px; margin: 0; color: #333;">
                <li>Interp J (Grid→Mesh)</li>
                <li>Assemble <b>K</b> & <b>f</b></li>
                <li><code>spsolve(K, f)</code></li>
                <li><b>Result:</b> A (on Nodes)</li>
            </ul>
        </div>

        <i class="fas fa-arrow-right" style="color: #cbd5e1; font-size: 20px;"></i>

        <div style="flex: 1; background: white; border: 1px solid #ef4444; border-top: 6px solid #ef4444; border-radius: 8px; padding: 15px; height: 320px; display: flex; flex-direction: column;">
            <h3 style="margin: 0 0 10px 0; font-size: 18px; color: #ef4444;">3. Recovery</h3>
            <div style="background: #f1f5f9; padding: 8px; border-radius: 4px; font-family: 'Fira Code', monospace; font-size: 11px; margin-bottom: 5px;">_compute_field</div>
            <ul style="font-size: 13px; line-height: 1.6; padding-left: 15px; margin: 0; color: #333;">
                <li>Interp A (Mesh→Grid)</li>
                <li>Compute <b>Curl(A)</b></li>
                <li>(∂Ay/∂x, -∂Ax/∂y)</li>
            </ul>
        </div>

        <div style="display: flex; flex-direction: column; align-items: center; width: 100px;">
            <i class="fas fa-arrow-down" style="color: #334155;"></i>
            <div style="height: 40px; border-left: 2px dashed #334155;"></div>
            <div style="background: #11caa0; color: white; padding: 10px; border-radius: 8px; text-align: center; font-size: 14px; width: 100%;">
                <b>Output</b><br>B Field
            </div>
        </div>

    </div>
</div>



<div class="slide-container bg-blue">
    <h2 style="margin-bottom: 10px;">Integration with ML Pipeline</h2>
    
    <div style="margin-top: 10px; text-align: center;">
        <svg viewBox="0 0 900 400" width="100%" height="220">
            <rect x="750" y="20" width="60" height="30" rx="5" fill="#10b981"/>
            <text x="820" y="40" font-size="18" fill="#fff">Known</text>
            <rect x="750" y="60" width="60" height="30" rx="5" fill="#fbbf24"/>
            <text x="820" y="80" font-size="18" fill="#fff">Unknown</text>
            
            <rect x="50" y="30" width="700" height="150" rx="15" fill="none" stroke="#fff" stroke-width="3"/>
            <text x="400" y="60" text-anchor="middle" font-size="24" font-weight="bold" fill="#fff">Forward Problem</text>
            
            <rect x="90" y="100" width="150" height="60" rx="8" fill="#10b981"/>
            <text x="165" y="128" text-anchor="middle" font-size="18" font-weight="bold" fill="#000">
                Current (<tspan font-style="italic" font-family="serif">J</tspan>)
            </text>
            
            <path d="M250,130 L280,130" stroke="#fff" stroke-width="3" fill="none" marker-end="url(#arrowWhiteRight)"/>
            
            <ellipse cx="360" cy="130" rx="60" ry="50" fill="#06b6d4"/>
            <text x="360" y="140" text-anchor="middle" font-size="22" font-weight="bold" fill="#fff">FEM</text>
            
            <path d="M430,130 L460,130" stroke="#fff" stroke-width="3" fill="none" marker-end="url(#arrowWhiteRight)"/>
            
            <rect x="480" y="100" width="200" height="60" rx="8" fill="#fbbf24"/>
            <text x="580" y="128" text-anchor="middle" font-size="16" font-weight="bold" fill="#000">
                Magnetic Field (<tspan font-style="italic" font-family="serif">B</tspan>)
            </text>
            
            <rect x="50" y="220" width="700" height="150" rx="15" fill="none" stroke="#fff" stroke-width="3"/>
            <text x="400" y="360" text-anchor="middle" font-size="24" font-weight="bold" fill="#fff">Inverse Problem</text>
            
            <rect x="90" y="260" width="150" height="60" rx="8" fill="#fbbf24"/>
            <text x="165" y="288" text-anchor="middle" font-size="18" font-weight="bold" fill="#000">
                Current (<tspan font-style="italic" font-family="serif">J</tspan>)
            </text>
            
            <path d="M290,290 L250,290" stroke="#fff" stroke-width="3" fill="none" marker-end="url(#arrowWhiteRight)"/>
            
            <ellipse cx="360" cy="290" rx="60" ry="50" fill="#06b6d4"/>
            <text x="360" y="300" text-anchor="middle" font-size="22" font-weight="bold" fill="#fff">ML</text>
            
            <path d="M470,290 L430,290" stroke="#fff" stroke-width="3" fill="none" marker-end="url(#arrowWhiteRight)"/>
            
            <rect x="480" y="260" width="200" height="60" rx="8" fill="#10b981"/>
            <text x="580" y="288" text-anchor="middle" font-size="16" font-weight="bold" fill="#000">
                Magnetic Field (<tspan font-style="italic" font-family="serif">B</tspan>)
            </text>
            
            <defs>
                <marker id="arrowWhiteRight" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto">
                    <polygon points="0,0 10,5 0,10" fill="#fff"/>
                </marker>
            </defs>
        </svg>
    </div>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
        
        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 12px; color: white;">
            <h3 style="color: #11caa0; font-size: 20px; margin-top: 0; margin-bottom: 8px;">Forward Problem (FEM)</h3>
            <p style="font-size: 15px; line-height: 1.5; margin: 0;">
                Given current density (<i style="font-family: serif;">J</i>), predict magnetic field (<i style="font-family: serif;">B</i>) distributions for training data generation.
            </p>
        </div>

        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 12px; color: white;">
            <h3 style="color: #11caa0; font-size: 20px; margin-top: 0; margin-bottom: 8px;">Inverse Problem (ML)</h3>
            <p style="font-size: 15px; line-height: 1.5; margin: 0;">
                From measured magnetic fields (<i style="font-family: serif;">B</i>), localize the source currents (<i style="font-family: serif;">J</i>). ML provides regularization for this ill-posed problem.
            </p>
        </div>

    </div>
</div>


<div class="slide-container bg-blue">
    <h2>Why FEM for Semiconductor Failure Analysis?</h2>
    
    <div class="grid-2" style="align-items: stretch; margin-top: 15px; gap: 20px;">
        
        <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 12px; border-left: 6px solid #ef4444; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
            <h3 style="color: #ef4444; margin-top: 0; margin-bottom: 15px; font-size: 24px;">
                <i class="fas fa-microchip" style="margin-right: 10px;"></i>The Chip Inspection Challenge
            </h3>
            <ul style="font-size: 16px; line-height: 1.5; margin: 0; padding-left: 10px; list-style: none;">
                <li style="margin-bottom: 10px; color: #fecaca;">
                    <span style="color: #ef4444; font-weight: bold; margin-right: 8px;">✗</span> 
                    <b>Complex Geometries:</b> Multiple metal layers stacked with curved wires and vertical connections
                </li>
                <li style="margin-bottom: 10px; color: #fecaca;">
                    <span style="color: #ef4444; font-weight: bold; margin-right: 8px;">✗</span> 
                    <b>Mixed Materials:</b> Copper wires, silicon substrate, and insulating layers all mixed together
                </li>
                <li style="margin-bottom: 10px; color: #fecaca;">
                    <span style="color: #ef4444; font-weight: bold; margin-right: 8px;">✗</span> 
                    <b>Open Space:</b> Magnetic fields leak beyond the chip boundaries
                </li>
                <li style="color: #fecaca;">
                    <span style="color: #ef4444; font-weight: bold; margin-right: 8px;">✗</span> 
                    <b>Multiple Solutions:</b> Same measurement could come from different fault locations
                </li>
            </ul>
        </div>
        
        <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 12px; border-left: 6px solid #10b981; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
            <h3 style="color: #10b981; margin-top: 0; margin-bottom: 15px; font-size: 24px;">
                <i class="fas fa-check-circle" style="margin-right: 10px;"></i>The FEM Advantage
            </h3>
            <ul style="font-size: 16px; line-height: 1.5; margin: 0; padding-left: 10px; list-style: none;">
                <li style="margin-bottom: 10px; color: #d1fae5;">
                    <span style="color: #10b981; font-weight: bold; margin-right: 8px;">✓</span> 
                    <b>Flexible Meshing:</b> Can handle curved wires and layers of any shape
                </li>
                <li style="margin-bottom: 10px; color: #d1fae5;">
                    <span style="color: #10b981; font-weight: bold; margin-right: 8px;">✓</span> 
                    <b>Multiple Materials:</b> Treats copper, silicon, and insulators differently in same model
                </li>
                <li style="margin-bottom: 10px; color: #d1fae5;">
                    <span style="color: #10b981; font-weight: bold; margin-right: 8px;">✓</span> 
                    <b>Physics-Based:</b> Automatically enforces correct physics (magnetic field rules)
                </li>
                <li style="color: #d1fae5;">
                    <span style="color: #10b981; font-weight: bold; margin-right: 8px;">✓</span> 
                    <b>Generates Training Data:</b> Creates synthetic examples for ML to learn from
                </li>
            </ul>
        </div>

    </div>

    <div style="margin-top: 30px; text-align: center;">
        <p style="background: rgba(16, 185, 129, 0.2); display: inline-block; padding: 12px 25px; border-radius: 50px; border: 1px solid #10b981; color: #d1fae5; font-size: 18px; line-height: 1.4; margin: 0;">
            <strong style="color: #10b981;">Impact:</strong> FEM enables non-destructive testing (NDT) of <br>multi-layer packages where analytical models fail.
        </p>
    </div>
</div>

<div class="slide-container bg-blue">
    <h2>Appendix: Full Source Code</h2>
    <div style="width: 100%; height: 100%; overflow: hidden; display: flex; flex-direction: column;">
        <pre class="code-block scrollable">
# -*- coding: utf-8 -*-
"""
FEM Forward Solver for 2D Magnetostatics using scikit-fem
==========================================================

Solves Maxwell's equations in the magnetostatic limit using the 
Finite Element Method (FEM) with scikit-fem.

Strong form:
    Laplacian(A_z) = -mu_0 * J_z

Weak form:
    integral( grad(A) . grad(v) dx ) = mu_0 * integral( J * v dx )

Where:
- A_z is the magnetic vector potential (z-component)
- J_z is the current density (perpendicular to the 2D plane)
- mu_0 is the permeability of free space
- v is the test function

The magnetic field is computed via B = curl(A):
    B_x = dA_z/dy
    B_y = -dA_z/dx

Installation:
    pip install scikit-fem """



import numpy as np
import sys
import subprocess
from typing import Tuple




def install_package(package):
    subprocess.check_call([sys.executable, "-m", "pip", "install", package])

try:
    from skfem import *
    from skfem.models.poisson import laplace, unit_load
    from skfem.helpers import grad, dot
    from scipy.sparse.linalg import spsolve
    SKFEM_AVAILABLE = True
except ImportError:
    print("scikit-fem not found. Installing...")
    try:
        install_package("scikit-fem")
        from skfem import *
        from skfem.models.poisson import laplace, unit_load
        from skfem.helpers import grad, dot
        SKFEM_AVAILABLE = True
        print("scikit-fem installed successfully!")
    except Exception as e:
        SKFEM_AVAILABLE = False
        print(f"Failed to install scikit-fem: {e}")




# Physical constants
MU_0 = 4 * np.pi * 1e-7  # Permeability of free space [H/m]


class MagnetostaticSolver:
    """
    scikit-fem based solver for 2D magnetostatics.
    
    Solves the Poisson equation for the magnetic vector potential:
        -Laplacian(A) = mu_0 * J
    
    with Dirichlet boundary conditions A = 0 on the domain boundary.
    """
    
    def __init__(self, nx: int = 64, ny: int = 64, 
                 Lx: float = 0.1, Ly: float = 0.1,
                 degree: int = 1):
        """
        Initialize the magnetostatic solver.
        
        Parameters
        ----------
        nx, ny : int
            Number of mesh elements in x and y directions
        Lx, Ly : float
            Physical domain size [m]
        degree : int
            Polynomial degree for finite elements (1 = linear, 2 = quadratic)
        """
        
        self.nx = nx
        self.ny = ny
        self.Lx = Lx
        self.Ly = Ly
        self.dx_grid = Lx / nx
        self.dy_grid = Ly / ny
        
        # Create mesh - triangular mesh scaled to physical dimensions
        self.mesh = MeshTri.init_tensor(
            np.linspace(0, Lx, nx + 1),
            np.linspace(0, Ly, ny + 1)
        )
        
        # Define element type based on degree
        self.element = ElementTriP2() if degree == 2 else ElementTriP1()
        
        # Create basis
        self.basis = Basis(self.mesh, self.element)

        """
        Identifies which DOF indices lie on the boundary using a geometric check (points where x 
        or y coordinates are near 0 or the domain limits)
        """
        # Find boundary DOFs for Dirichlet BC
        epsilon = 1e-10
        self.boundary_dofs = self.basis.get_dofs(
            lambda x: (x[0] < epsilon) | (x[0] > Lx - epsilon) | 
                      (x[1] < epsilon) | (x[1] > Ly - epsilon)
        ).all()
        
    def solve_from_array(self, J_array: np.ndarray) -> Tuple[np.ndarray, np.ndarray, np.ndarray]:
        """
        Solve the magnetostatic problem from a numpy array of current density.
        
        Parameters
        ----------
        J_array : np.ndarray
            Current density field of shape (ny, nx) [A/m^2]
        
        Returns
        -------
        A : np.ndarray
            Magnetic vector potential of shape (ny, nx)
        Bx, By : np.ndarray
            Magnetic field components of shape (ny, nx)
        """
    
        
        # Create interpolator from the array
        x_grid = np.linspace(0, self.Lx, self.nx)
        y_grid = np.linspace(0, self.Ly, self.ny)
        
        from scipy.interpolate import RegularGridInterpolator
        # RegularGridInterpolator expects (y, x) ordering for the data
        interp = RegularGridInterpolator((y_grid, x_grid), J_array, 
                                          bounds_error=False, fill_value=0.0)
        
        # Define the source term (right-hand side)
        """u, v: Trial and test basis functions
           w: Quadrature weights and Jacobian (automatic)
           assemble(): Loops over all elements, evaluates bilinear form at all quadrature points,
                       integrates via Gaussian quadrature, accumulates into sparse matrix"""
        @LinearForm
        def source_functional(v, w):
            # Evaluate J at quadrature points
            points = np.column_stack([w.x[1].flatten(), w.x[0].flatten()])
            J_vals = interp(points).reshape(w.x[0].shape)
            return MU_0 * J_vals * v
        
        # Assemble stiffness matrix (Laplacian)
        
        @BilinearForm
        def stiffness(u, v, w):
            return dot(grad(u), grad(v))
        
        K = stiffness.assemble(self.basis)
        
        # Assemble load vector
        f = source_functional.assemble(self.basis)
        
        # Apply Dirichlet boundary conditions (A = 0 on boundary)
        K_bc, f_bc = enforce(K, f, D=self.boundary_dofs)        #funtion of scikit-fem
        
        # Solve the linear system
        A_solution = spsolve(K_bc, f_bc)            #function of scipy.sparse.linalg
        
        # Compute magnetic field B = curl(A)
        # B_x = dA/dy, B_y = -dA/dx
        Bx_array, By_array = self._compute_magnetic_field(A_solution)
        
        # Interpolate to regular grid
        A_array = self._solution_to_grid(A_solution)
        
        return A_array, Bx_array, By_array
    
    def _compute_magnetic_field(self, A_solution: np.ndarray) -> Tuple[np.ndarray, np.ndarray]:
        """
        Compute magnetic field components from vector potential.
        
        B_x = dA/dy, B_y = -dA/dx
        """
        # Interpolate A to regular grid first, then compute gradients
        A_grid = self._solution_to_grid(A_solution)
        
        # Compute grid spacing
        dx = self.Lx / (self.nx - 1) if self.nx > 1 else self.Lx
        dy = self.Ly / (self.ny - 1) if self.ny > 1 else self.Ly
        
        # B_x = dA/dy (central differences in interior, forward/backward at boundaries)
        Bx = np.zeros_like(A_grid)
        Bx[1:-1, :] = (A_grid[2:, :] - A_grid[:-2, :]) / (2 * dy)
        Bx[0, :] = (A_grid[1, :] - A_grid[0, :]) / dy
        Bx[-1, :] = (A_grid[-1, :] - A_grid[-2, :]) / dy
        
        # B_y = -dA/dx
        By = np.zeros_like(A_grid)
        By[:, 1:-1] = -(A_grid[:, 2:] - A_grid[:, :-2]) / (2 * dx)
        By[:, 0] = -(A_grid[:, 1] - A_grid[:, 0]) / dx
        By[:, -1] = -(A_grid[:, -1] - A_grid[:, -2]) / dx
        
        return Bx, By
    
    def _solution_to_grid(self, solution: np.ndarray) -> np.ndarray:
        """
        Interpolate FEM solution to regular grid.
        """
        from scipy.interpolate import LinearNDInterpolator
        
        # Get nodal coordinates
        coords = self.mesh.p.T  # (n_nodes, 2)
        
        x_grid = np.linspace(0, self.Lx, self.nx)
        y_grid = np.linspace(0, self.Ly, self.ny)
        X, Y = np.meshgrid(x_grid, y_grid)
        
        # Handle solution size mismatch (P2 elements have more DOFs)
        if len(solution) != len(coords):
            # For P2 elements, use basis interpolation
            result = np.zeros((self.ny, self.nx))
            for i in range(self.ny):
                for j in range(self.nx):
                    try:
                        result[i, j] = self.basis.interpolator(solution)(
                            np.array([[x_grid[j]], [y_grid[i]]])
                        )[0]
                    except:
                        result[i, j] = 0.0
            return result
        
        # For P1 elements, use linear interpolation from mesh nodes
        interp = LinearNDInterpolator(coords, solution, fill_value=0.0)
        return interp(X, Y)


def forward_solve(J: np.ndarray, dx: float = 0.01, dy: float = 0.01, degree: int = 1) -> Tuple[np.ndarray, np.ndarray, np.ndarray]:
    """
    Complete forward solve: J -> B using FEM (scikit-fem).
    
    Given current density J, compute magnetic field B.
    
    Parameters
    ----------
    J : np.ndarray
        Current density field of shape (ny, nx) [A/m^2]
    dx, dy : float
        Grid spacing [m], default 1 cm
    degree : int
        Polynomial degree for finite elements (1 = linear, 2 = quadratic)
    
    Returns
    -------
    A : np.ndarray
        Magnetic vector potential
    Bx, By : np.ndarray
        Magnetic field components
    """
    if not SKFEM_AVAILABLE:
        raise ImportError("scikit-fem is required. Install via: pip install scikit-fem")
        
    ny, nx = J.shape
    Lx = nx * dx
    Ly = ny * dy
    
    solver = MagnetostaticSolver(nx=nx, ny=ny, Lx=Lx, Ly=Ly, degree=degree)
    A, Bx, By = solver.solve_from_array(J)
    
    return A, Bx, By


def create_wire_current(nx: int, ny: int, x0: float, y0: float, 
                        radius: float, current: float) -> np.ndarray:
    """
    Create a current density distribution for a wire (circular cross-section).
    
    Parameters
    ----------
    nx, ny : int
        Grid dimensions
    x0, y0 : float
        Wire center position (normalized 0-1)
    radius : float
        Wire radius (normalized 0-1)
    current : float
        Total current [A] (distributed uniformly)
    
    Returns
    -------
    J : np.ndarray
        Current density field of shape (ny, nx)
    """
    x = np.linspace(0, 1, nx)
    y = np.linspace(0, 1, ny)
    X, Y = np.meshgrid(x, y)
    
    # Distance from wire center
    r = np.sqrt((X - x0)**2 + (Y - y0)**2)
    
    # Wire cross-sectional area
    area = np.pi * radius**2
    
    # Current density (uniform inside wire)
    J = np.where(r <= radius, current / area, 0.0)
    
    return J


def create_gaussian_current(nx: int, ny: int, x0: float, y0: float,
                            sigma: float, amplitude: float) -> np.ndarray:
    """
    Create a Gaussian current density distribution.
    
    Parameters
    ----------
    nx, ny : int
        Grid dimensions
    x0, y0 : float
        Center position (normalized 0-1)
    sigma : float
        Standard deviation (normalized 0-1)
    amplitude : float
        Peak current density [A/m^2]
    
    Returns
    -------
    J : np.ndarray
        Current density field of shape (ny, nx)
    """
    x = np.linspace(0, 1, nx)
    y = np.linspace(0, 1, ny)
    X, Y = np.meshgrid(x, y)
    
    J = amplitude * np.exp(-((X - x0)**2 + (Y - y0)**2) / (2 * sigma**2))
    
    return J


def test_solver():
    """
    Test the scikit-fem FEM solver with a simple wire configuration.
    """
    if not SKFEM_AVAILABLE:
        print("scikit-fem not available. Please install via:")
        print("  pip install scikit-fem")
        return
    
    import matplotlib.pyplot as plt
    
    print("Testing scikit-fem FEM Solver...")
    
    # Grid parameters
    nx, ny = 64, 64
    Lx, Ly = 0.1, 0.1  # 10 cm x 10 cm domain
    dx, dy = Lx / nx, Ly / ny
    
    def plot_results(J, A, Bx, By, title_suffix, filename, degree):
        B_magnitude = np.sqrt(Bx**2 + By**2)
        
        print(f"Solution computed for {title_suffix} (P{degree})!")
        print("  Grid: {} x {}".format(nx, ny))
        print("  Max |B|: {:.2e} T".format(B_magnitude.max()))
        print("  Max A: {:.2e} T*m".format(A.max()))
        
        fig, axes = plt.subplots(2, 2, figsize=(10, 10))
        extent = [0, Lx * 100, 0, Ly * 100]
        
        # Current density
        im0 = axes[0, 0].imshow(J, origin='lower', extent=extent, cmap='hot')
        axes[0, 0].set_title(f'Current Density J [A/m^2] ({title_suffix})')
        axes[0, 0].set_xlabel('x [cm]')
        axes[0, 0].set_ylabel('y [cm]')
        plt.colorbar(im0, ax=axes[0, 0])
        
        # Vector potential
        im1 = axes[0, 1].imshow(A, origin='lower', extent=extent, cmap='viridis')
        axes[0, 1].set_title(f'Vector Potential A [T*m] ({title_suffix} P{degree})')
        axes[0, 1].set_xlabel('x [cm]')
        axes[0, 1].set_ylabel('y [cm]')
        plt.colorbar(im1, ax=axes[0, 1])
        
        # Magnetic field magnitude
        im2 = axes[1, 0].imshow(B_magnitude, origin='lower', extent=extent, cmap='plasma')
        axes[1, 0].set_title(f'Magnetic Field |B| [T] ({title_suffix} P{degree})')
        axes[1, 0].set_xlabel('x [cm]')
        axes[1, 0].set_ylabel('y [cm]')
        plt.colorbar(im2, ax=axes[1, 0])
        
        # Magnetic field vectors
        x = np.linspace(0, Lx * 100, nx)
        y = np.linspace(0, Ly * 100, ny)
        axes[1, 1].streamplot(x, y, Bx, By, density=1.5, color=B_magnitude, cmap='plasma')
        axes[1, 1].set_title(f'Magnetic Field Lines ({title_suffix} P{degree})')
        axes[1, 1].set_xlabel('x [cm]')
        axes[1, 1].set_ylabel('y [cm]')
        axes[1, 1].set_xlim(0, Lx * 100)
        axes[1, 1].set_ylim(0, Ly * 100)
        axes[1, 1].set_aspect('equal')
        
        plt.tight_layout()
        plt.savefig(filename, dpi=150)
        # plt.show() # blocking
        plt.close(fig)
        print(f"Output saved to '{filename}'\n")

    # 1. Wire test
    print("Test 1: Wire Current")
    J_wire = create_wire_current(nx, ny, 0.5, 0.5, 0.05, 1.0)
    
    # Test P1
    degree = 1
    A, Bx, By = forward_solve(J_wire, dx, dy, degree=degree)
    plot_results(J_wire, A, Bx, By, "Wire", f"fem_solver_test_P{degree}.png", degree)

    # Test P2
    degree = 2
    print(f"Test 1 (P{degree}): Wire Current")
    A, Bx, By = forward_solve(J_wire, dx, dy, degree=degree)
    plot_results(J_wire, A, Bx, By, "Wire", f"fem_solver_test_P{degree}.png", degree)

    # 2. Gaussian test (P2 default for variety)
    print("Test 2: Gaussian Current")
    J_gauss = create_gaussian_current(nx, ny, 0.5, 0.5, 0.1, 1.0) # sigma=0.1
    degree = 2
    A, Bx, By = forward_solve(J_gauss, dx, dy, degree=degree)
    plot_results(J_gauss, A, Bx, By, "Gaussian", "fem_solver_test_gaussian.png", degree)

    print("\nscikit-fem FEM Solver tests completed!")


if __name__ == "__main__":
    test_solver()

        </pre>
    </div>
</div>

<div class="slide-container bg-cream">
    <h2>Simulation Results: Test Cases</h2>
    <div class="grid-2" style="height: 100%; gap: 30px; margin-top: 5px;">
        <div style="display: flex; flex-direction: column; align-items: center; height: 100%;">
            <h3 style="margin-bottom: 10px; color: #005088; border-bottom: 2px solid #11caa0; padding-bottom: 5px; width: 100%; text-align: center;">Test Case 1: Wire Current</h3>
            
            <div class="img-frame" style="height: 210px; width: 100%; border-color: #005088; background: #fff;">
                <img src="fem_solver_test.png" alt="Wire Current Simulation Result" style="width: 100%; height: 100%; object-fit: contain; padding: 10px;" />
            </div>
            
            <div style="background: white; border-radius: 8px; padding: 10px; margin-top: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); width: 100%;">
                <p style="font-size: 14px; margin: 0; color: #333; line-height: 1.4;">
                    <strong>Observation:</strong> The uniform current in a circular wire generates a <span class="math-inline">1/r</span> decay of the magnetic field magnitude outside the wire and the circular field lines.
                </p>
            </div>
        </div>

        <div style="display: flex; flex-direction: column; align-items: center; height: 100%;">
            <h3 style="margin-bottom: 10px; color: #005088; border-bottom: 2px solid #11caa0; padding-bottom: 5px; width: 100%; text-align: center;">Test Case 2: Gaussian Current</h3>
            
            <div class="img-frame" style="height: 210px; width: 100%; border-color: #005088; background: #fff;">
                <img src="fem_solver_test_gaussian.png" alt="Gaussian Current Simulation Result" style="width: 100%; height: 100%; object-fit: contain; padding: 10px;" />
            </div>
            
            <div style="background: white; border-radius: 8px; padding: 10px; margin-top: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); width: 100%;">
                <p style="font-size: 14px; margin: 0; color: #333; line-height: 1.4;">
                    <strong>Observation:</strong> With a Gaussian distributed current density, the field transitions are significantly smoother. Unlike the sharp cutoff of the wire model, this distribution represents a more diffuse source, useful for modeling soft magnetic materials.
                </p>
            </div>
        </div>
    </div>
</div>

<script>
    let currentSlide = 0;
    const slides = document.querySelectorAll('.slide-container');
    const counter = document.getElementById('counter');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');

    function updateSlide() {
        slides.forEach((slide, index) => {
            slide.classList.remove('active');
            if (index === currentSlide) {
                slide.classList.add('active');
            }
        });
        
        // Update Counter
        counter.textContent = `${currentSlide + 1} / ${slides.length}`;
        
        // Update Button States
        prevBtn.disabled = currentSlide === 0;
        nextBtn.disabled = currentSlide === slides.length - 1;
    }

    function changeSlide(direction) {
        currentSlide += direction;
        
        // Boundary Checks
        if (currentSlide < 0) currentSlide = 0;
        if (currentSlide >= slides.length) currentSlide = slides.length - 1;
        
        updateSlide();
    }

    // Keyboard Navigation
    document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowRight' || e.key === ' ') {
            changeSlide(1);
        } else if (e.key === 'ArrowLeft') {
            changeSlide(-1);
        }
    });

    // Initial State
    updateSlide();
</script>

</body>
</html>